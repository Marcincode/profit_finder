<!DOCTYPE html>
<html>
<head>
    <title>iPhone Profit Finder</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>iPhone Profit Finder</h1>
    <form method="POST" action="/run_script">
        <button type="submit">Find new profit offers!</button>
    </form>
    <form method="POST">
        <table>
            <tr>
                {% for header in csv_data[0] %}
                    <th>{{ header }}</th>
                {% endfor %}
            </tr>
            {% for row in csv_data[1:] %}
                <tr>
                    {% for cell in row %}
                        {% if loop.index == loop.length %}
                            <td>
                                <select class="update-dropdown" name="updated_data[]">
                                    <option value="{{ row[-1] }}" selected>{{ row[-1] }}</option>
                                    <option value="{{ 'Y' if row[-1] == 'N' else 'N' }}">{{ 'Y' if row[-1] == 'N' else 'N' }}</option>
                                </select>
                            </td>
                        {% elif loop.index0 == 9 %}
                            <td><a href="{{ cell }}">{{ cell }}</a></td>
                        {% else %}
                            <td>{{ cell }}</td>
                        {% endif %}
                    {% endfor %}
                </tr>
            {% endfor %}
        </table>        
        <button type="submit" id="hidden-submit-button" style="display: none;"></button>
    </form>
<script>
        const dropdowns = document.querySelectorAll('.update-dropdown');
    
        dropdowns.forEach(dropdown => {
            dropdown.addEventListener('change', function() {
                const submitButton = document.getElementById('hidden-submit-button');
                submitButton.click();
            });
        });
</script>
</body>
</html>
